<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Shop Online</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="../css/homestyle.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
<link href="../css/style-ie.css" rel="stylesheet" type="text/css" />
<![endif]-->
<style>
    .button{
            margin-left: 10%;
        text-decoration:none; 
        text-align:center; 
 padding:11px 11px; 
 border:solid 1px #004F72; 
 -webkit-border-radius:4px;
 -moz-border-radius:4px; 
 border-radius: 4px; 
 font:18px Arial, Helvetica, sans-serif; 
 font-weight:bold; 
 color:#E5FFFF; 
 background-color:#3BA4C7; 
 background-image: -moz-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -webkit-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -o-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -ms-linear-gradient(top, #3BA4C7 0% ,#1982A5 100%); 
 filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1982A5', endColorstr='#1982A5',GradientType=0 ); 
 background-image: linear-gradient(top, #3BA4C7 0% ,#1982A5 100%);   
 -webkit-box-shadow:0px 0px 2px #bababa, inset 0px 0px 1px #ffffff; 
 -moz-box-shadow: 0px 0px 2px #bababa,  inset 0px 0px 1px #ffffff;  
 box-shadow:0px 0px 2px #bababa, inset 0px 0px 1px #ffffff;
    }
        .button-left{
            margin-left: 40%;
        text-decoration:none; 
        text-align:center; 
 padding:11px 11px; 
 border:solid 1px #004F72; 
 -webkit-border-radius:4px;
 -moz-border-radius:4px; 
 border-radius: 4px; 
 font:18px Arial, Helvetica, sans-serif; 
 font-weight:bold; 
 color:#E5FFFF; 
 background-color:#3BA4C7; 
 background-image: -moz-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -webkit-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -o-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -ms-linear-gradient(top, #3BA4C7 0% ,#1982A5 100%); 
 filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1982A5', endColorstr='#1982A5',GradientType=0 ); 
 background-image: linear-gradient(top, #3BA4C7 0% ,#1982A5 100%);   
 -webkit-box-shadow:0px 0px 2px #bababa, inset 0px 0px 1px #ffffff; 
 -moz-box-shadow: 0px 0px 2px #bababa,  inset 0px 0px 1px #ffffff;  
 box-shadow:0px 0px 2px #bababa, inset 0px 0px 1px #ffffff;
    }
    .button-right{
            margin-left: 5%;
        text-decoration:none; 
        text-align:center; 
 padding:11px 11px; 
 border:solid 1px #004F72; 
 -webkit-border-radius:4px;
 -moz-border-radius:4px; 
 border-radius: 4px; 
 font:18px Arial, Helvetica, sans-serif; 
 font-weight:bold; 
 color:#E5FFFF; 
 background-color:#3BA4C7; 
 background-image: -moz-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -webkit-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -o-linear-gradient(top, #3BA4C7 0%, #1982A5 100%); 
 background-image: -ms-linear-gradient(top, #3BA4C7 0% ,#1982A5 100%); 
 filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#1982A5', endColorstr='#1982A5',GradientType=0 ); 
 background-image: linear-gradient(top, #3BA4C7 0% ,#1982A5 100%);   
 -webkit-box-shadow:0px 0px 2px #bababa, inset 0px 0px 1px #ffffff; 
 -moz-box-shadow: 0px 0px 2px #bababa,  inset 0px 0px 1px #ffffff;  
 box-shadow:0px 0px 2px #bababa, inset 0px 0px 1px #ffffff;
    }
        ul.rig {
	list-style: none;
	font-size: 0px;
	margin-left: -2.5%; /* should match li left margin */
}
ul.rig li {
	display: inline-block;
	padding: 10px;
	margin: 0 0 2.5% 2.5%;
	background: #fff;
	border: 1px solid #ddd;
	font-size: 16px;
	font-size: 1rem;
	vertical-align: top;
	box-shadow: 0 0 5px #ddd;
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	-webkit-box-sizing: border-box;
}
ul.rig li a{
        text-decoration: none;
        color: #999;
}
ul.rig li a:hover{
        color: #333;
}
ul.rig li img {
	max-width: 100%;
	height: auto;
	margin: 0 0 10px;
}
ul.rig li h3 {
	margin: 0 0 5px;
}
ul.rig li p {
	font-size: .9em;
	line-height: 1.5em;
	color: #999;
}
/* class for 2 columns */
ul.rig.columns-2 li {
	width: 47.5%; /* this value + 2.5 should = 50% */
}
/* class for 3 columns */
ul.rig.columns-3 li {
	width: 30.83%; /* this value + 2.5 should = 33% */
}
/* class for 4 columns */
ul.rig.columns-4 li {
	width: 22.5%; /* this value + 2.5 should = 25% */
}
 
@media (max-width: 480px) {
	ul.grid-nav li {
		display: block;
		margin: 0 0 5px;
	}
	ul.grid-nav li a {
		display: block;
	}
	ul.rig {
		margin-left: 0;
	}
	ul.rig li {
		width: 100% !important; /* over-ride all li styles */
		margin: 0 0 20px;
	}
        
}
</style>
</head>
<%@page contentType="text/html" pageEncoding="UTF-8"%>
<%@ page import ="java.sql.*,java.util.*" %>
<body>
    <center>
  <div class="wrapper">
    <div class="logo"> Shop<strong>Online</strong></div>
    <div class="menu">
      <ul class="solidblockmenu">
        <li><a href="products.jsp?page_id=1">Home</a></li>
        <li><a href="category.jsp">Categories</a></li>
        <li><a href="deals.jsp">Hot Deals</a></li>
        <li><a href="order.jsp">Place Order</a></li>
        <li><a href="track_your_order.jsp"> Track Your Order </a></li>
        <li><a href="../api/logout.jsp"> Logout </a></li>
      </ul>
      <div class="clear"></div>
    </div>
  </div>
  
  <%
    String productQuery = "SELECT * FROM product_table";
    String driverName = "com.mysql.jdbc.Driver";
    String dbSelectURL =  "jdbc:mysql://localhost/shop_cart";
    String dbName = "root";
    String dbPassword = "";
    
    Set<String> setOfCategory = null;
    if(session.getAttribute("categories") == null){
        setOfCategory = new HashSet<>();
        ResultSet rs = null;
        try{
                Class.forName(driverName);
                Connection con = DriverManager.getConnection(dbSelectURL, dbName ,dbPassword);
                Statement st = con.createStatement();
                rs = st.executeQuery(productQuery);
                
        }
        catch(Exception e){
        out.println("error<br>");e.printStackTrace();
         }
        while(rs.next()){
                       String productCategory = rs.getString("category");
                       setOfCategory.add(productCategory);
        }
         session.setAttribute("categories", setOfCategory);
    }
    else{
        setOfCategory = (Set<String>) session.getAttribute("categories");
    }
    out.println("<form action='../api/category_display.jsp' method='GET'>");
    out.println("Select a Category.");
    out.println("<select id='category' name='category'>");
    for(String option: setOfCategory){
        out.println("<option value='" + option + "'>");
        out.println(option);
        out.println("</option>");
    }
    out.println("</select>");
    out.println("Sort By");
    out.println("<select id='sort' name='sort'>");
    out.println("<option value = 'price' > Price </option>");
    out.println("<option value = 'name' > Name </option>");
    out.println("<option value = 'availability' > Availability </option>");
    out.println("</select>");
    out.println("<input type='submit' class='button' value='Submit' />");
    out.println("</form>");
    if(session.getAttribute("category") != null && session.getAttribute("sort") != null){
      //out.println((String) session.getAttribute("sort"));
      //sout.println("123");
      String categoryQuery = "SELECT * FROM product_table WHERE category = ? ORDER BY ? ASC";
      out.println("<ul class='rig columns-4'>"); 
      //out.println("123");
        try{
                Class.forName(driverName);
                Connection conn = DriverManager.getConnection(dbSelectURL, dbName, dbPassword);
                PreparedStatement ps = conn.prepareStatement(categoryQuery);
                String category = (String) session.getAttribute("category");
                String sortCategory = (String) session.getAttribute("sort");
                ps.setString(1, category);
                ps.setString(2, sortCategory);
                ResultSet rs_1 = ps.executeQuery();
           
                while(rs_1.next()){
                     String productName = rs_1.getString("name");
                     String productId = rs_1.getString("product_id");
                     String productPrice = rs_1.getString("price");
                     String productDescription = rs_1.getString("description");
                     String imagePath = rs_1.getString("image_path");
                     out.println("<li>");
                     out.println("<img height='209' width='140' src=");
                     out.println(imagePath);
                     out.println("/>");
                    out.println("<h3>");
                    out.println("<a href='product_display.jsp?id=");
                    out.println(productId);
                    out.println("'>");
                    out.println(productName);
                    out.println("</a>");
                    out.println("</h3>");
                    out.println("<p>");
                    out.println(productDescription);
                    out.println("<br>");
                    out.println("<b>");
                    out.println(productPrice);
                    out.println("</b>");
                    out.println("</p>");
                    out.println("</li>");
                }
                 out.println("</ul>");
                
        }
              catch(Exception e){
        out.println(e.toString());e.printStackTrace();
        }
   }
%>
    </center>
</body>
</html>